# Desabilitar Cache
<IfModule mod_headers.c>
    Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
    Header set Expires 0
</IfModule>

# Protege o arquivo .htaccess
<Files .htaccess>
    Order allow,deny
    Deny from all
</Files>

# Reescrita para URL Amigável
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]
</IfModule>

# Bloqueia solicitações de arquivos maliciosos
<FilesMatch "(wp-config.php|php.ini|php5.ini|readme.html|license.txt)">
    Order allow,deny
    Deny from all
</FilesMatch>

# Adiciona cabeçalhos de segurança
Header always set X-XSS-Protection "1; mode=block"
Header always set X-Content-Type-Options "nosniff"
Header always set X-Permitted-Cross-Domain-Policies "none"
Header always set Referrer-Policy "no-referrer-when-downgrade"
Header always unset X-Frame-Options
Header always set Content-Security-Policy "script-src 'self' https://static.cloudflareinsights.com https://ajax.googleapis.com https://connect.facebook.net; frame-ancestors *"

# Configura HSTS (HTTP Strict Transport Security)
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

# Protege contra ataques de injeção de SQL
RewriteCond %{QUERY_STRING} (<|%3C).script.(>|%3E) [NC,OR]
RewriteCond %{QUERY_STRING} GLOBALS(=|[|%[0-9A-Z]{0,2}) [OR]
RewriteCond %{QUERY_STRING} _REQUEST(=|[|%[0-9A-Z]{0,2})
RewriteRule ^(.*)$ index.php [F,L]

# Comprime arquivos
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/font-woff
    AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
    AddOutputFilterByType DEFLATE application/x-font-ttf
    AddOutputFilterByType DEFLATE application/x-font-woff
    AddOutputFilterByType DEFLATE font/opentype
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE text/css application/javascript application/x-javascript
</IfModule>

# Impede que bots e spammers acessem o site
RewriteCond %{HTTP_USER_AGENT} ^.*(bot|spider|crawl|archiver|curl|iver|facebookexternalhit|WhatsApp|Slackbot).*$ [NC]
RewriteRule .* - [F,L]

# Reduz o tamanho das imagens em 90%
<IfModule mod_pagespeed.so>
    ModPagespeed on
    ModPagespeedImageRecompressionQuality 70
</IfModule>

# Evita acessos às pastas
Options -Indexes

# Desativa métodos HTTP inseguros
RewriteCond %{REQUEST_METHOD} ^(TRACE|TRACK)
RewriteRule .* - [F]